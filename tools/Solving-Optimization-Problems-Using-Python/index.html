<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.11.2 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Solving optimization problems using Python - AnyScript Community</title>
<meta name="description" content="The ability to create and run mathematical optimization problems, using third party software is a valuable tool.">


  <meta name="author" content="Bjørn Keller Jensen">


<meta property="og:type" content="article">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="AnyScript Community">
<meta property="og:title" content="Solving optimization problems using Python">
<meta property="og:url" content="https://anyscript.org/tools/Solving-Optimization-Problems-Using-Python/">


  <meta property="og:description" content="The ability to create and run mathematical optimization problems, using third party software is a valuable tool.">



  <meta property="og:image" content="https://anyscript.org/assets/images/og_image.jpg">





  <meta property="article:published_time" content="2018-11-13T00:00:00+01:00">





  

  


<link rel="canonical" href="https://anyscript.org/tools/Solving-Optimization-Problems-Using-Python/">





  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": "https://anyscript.org",
      "logo": "/assets/images/anyscript_logo_community.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "name": "AnyBody Technology",
      "url": "https://anyscript.org",
      "sameAs": {"linkedin":"https://www.linkedin.com/company/anybody-technology-a-s","github":"https://github.com/anybody","youtube":"https://www.youtube.com/user/anybodytech","facebook":"https://www.facebook.com/groups/AnyBodyGroup/"}
    }
  </script>



  <meta name="google-site-verification" content="Gads1dEJfrM11RlSRBUKWHHjKWkf_JfNOC1Deq7LaF0" />





<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="AnyScript Community Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/icons/favicon-16x16.png">
<link rel="manifest" href="/assets/images/icons/manifest.json">
<link rel="mask-icon" href="/assets/images/icons/safari-pinned-tab.svg" color="#b91d47">
<link rel="shortcut icon" href="/assets/images/icons/favicon.ico">
<meta name="msapplication-config" content="/assets/images/icons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">



<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW"/>


<style type="text/css">
#watermark {
  color: #e0e0e0;
  font-size: 200pt;
  text-align: center;
  -webkit-transform: rotate(-45deg);
  -moz-transform: rotate(-45deg);
  position: fixed;
  min-height:50%; 
  min-width:50%;
  margin: 0;
  z-index: -1;
  left:50;
  top:50;
}
</style>


<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="https://anyscript.org/"><img src="/assets/images/anyscript_logo.svg" height="200" width="180" align="top"/></a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item">
              <a href="https://anyscript.org/getting-started/" >Quick-Start guide</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://anyscript.org/all-posts/" >Blog posts</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://forum.anyscript.org/" >Forum <i class="fas fa-external-link-alt" aria-hidden="true"></i></a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://github.com/AnyBody/support/wiki" >Wiki <i class="fas fa-external-link-alt" aria-hidden="true"></i></a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://github.com/AnyBody/" >Repositories <i class="fas fa-external-link-alt" aria-hidden="true"></i></a>
            </li>
          
        </ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    
    
    <div id="watermark">
<p>Draft Draft Draft<br/>Draft Draft Draft Draft<br/>Draft Draft Draft Draft Draft</p>
    </div>
    
    

    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/people/bkj.jpg" alt="Bjørn Keller Jensen" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Bjørn Keller Jensen</h3>
    
    
      <p class="author__bio" itemprop="description">
        Master Student, Sports Technology, Aalborg University, Intern at AnyBody Technology
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      
        <li>
          <a href="mailto:bkje14@student.aau.dk">
            <meta itemprop="email" content="bkje14@student.aau.dk" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/bkje14" itemprop="sameAs">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Solving optimization problems using Python">
    <meta itemprop="description" content="The ability to create and run mathematical optimization problems, using third party software is a valuable tool.">
    <meta itemprop="datePublished" content="November 13, 2018">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Solving optimization problems using Python
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>The AnyBody Modeling System (AMS) provides a build-in optimization
class <code>AnyOptStudy</code>, and with it you have the opportunity to solve advanced mathematical optimization problems. You can get a taste of how it works in this <a href="https://anyscript.org/tutorials/">new tutorial</a>
Of course there can be situations were you want to do a little more than what the AMS optimization offers. Say you have two seperate models were you wanted to optimize some parameter across
the performance in both models? or perhaps you wanted to use a specific algorithm suitable for your exact problem? To solve these kinds of problems, you
could perform the optimization process from a third party software.</p>

<p>In this post we will demonstrate how these problems can be solved using Python.
This topic is part of the new [Anybodytutorial]
(https://anyscript.org/tutorials/Parameter_studies_and_optimization/index.html)
<em>Parameter Studies and Optimization</em> which describes the content of this post in
detail. The model shown in this post is also part of the new AMS tutorial, and
you can download and read a detailed description of it
<a href="https://anyscript.org/tutorials/Parameter_studies_and_optimization/lesson3.html">here.</a></p>

<p>As part of the post we will show how to integrate the <a href="https://docs.scipy.org/doc/scipy/reference/index.html">Scipy</a> optimization package
<code>Scipy.optimize.minimize</code> by running the <a href="https://anyscript.org/ammr-doc/auto_examples/Sports/plot_BikeModel2D.html#sphx-glr-auto-examples-sports-plot-bikemodel2d-py">Anybody 2D bike model</a> from Python, using the AnyPyTools package.</p>

<p>The process of performing optimization of AMS models through Python can be sketched in four steps:</p>

<ul>
  <li>Defining a function to call the models using AnyPyTools and extract the designvariables</li>
  <li>Defining a objective function to be either minimized or maximized</li>
  <li>Defining the constraints and bounds of the problem</li>
  <li>Running the optimization</li>
</ul>

<p>And the whole python code to complete these four steps could look like this:</p>

<pre><code class="language-python">  
    import math
    import scipy
    from anypytools import AnyPyProcess
    from anypytools.macro_commands import Load, OperationRun, Dump SetValue


    def run_model(saddle_height, saddle_pos, silent=False):
        """Run the AnyBody model and return the metabolism results"""
        macro = [
            Load("BikeModel2D.main.any"),
            SetValue("Main.BikeParameters.SaddleHeight", saddle_height),
            SetValue("Main.BikeParameters.SaddlePos", saddle_pos),
            OperationRun("Main.Study.InverseDynamics"),
            Dump("Main.Study.Output.Pmet"),
            Dump("Main.Study.Output.Abscissa.t"),
        ]
        app = AnyPyProcess(silent=silent)
        results = app.start_macro(macro)
        return results[0]


    def objfun(designvars):
        """Calculate the objective function value"""
        saddle_height = designvars[0]
        saddle_pos = designvars[1]
        result = run_model(saddle_height, saddle_pos, silent=True)

        if "ERROR" in result:
            raise ValueError("Failed to run model")

        pmet = scipy.integrate.trapz(result["Pmet"], result["Abscissa.t"])

        return float(pmet)


    def seat_distance_constraint(designvars):
        """Compute contraint value which must be larger than zero"""
        return math.sqrt(designvars[0] ** 2 + designvars[1] ** 2) - 0.66


    constaints = {"type": "ineq", "fun": seat_distance_constraint}
    bounds = [(0.61, 0.69), (-0.22, -0.05)]
    initial_guess = (0.68, -0.15)

    solution = scipy.optimize.minimize(
        objfun, initial_guess, constraints=constaints, bounds=bounds, method="SLSQP"
    )

    print(solution)
</code></pre>

<p>To elaborate a little on the sections, the first part defines the <code>run_model</code>
function. This function takes in two arguments and assigns them to the
saddleheight and saddleposition in the AMS model. The function returns the
<code>Pmet</code> value for each timestep in the model. Details and advanced options of
this function and it’s components can be found in the <code>AnyPyTools</code>
<a href="https://anybody-research-group.github.io/anypytools-docs/">documentation</a>. The
second part defines the objective function in question. This function takes in a
list of design variable arguments and utilizes the <code>run_model</code> function,
afterwards it integrates the <code>Pmet</code> over the whole time series and returns the
result. Next up, the constraints and bounds are defined. For this example only a
seat distance constraint is present. The bounds for each of the design
variables is defined in the <code>bounds</code> variable. Lastly, the optimization process is
performed, and here it envokes the <a href="https://docs.scipy.org/doc/scipy/reference/optimize.minimize-slsqp.html#optimize-minimize-slsqp">SLSQP</a>
algorithm.</p>

<p>And there we have it. A full optimization of a AMS model, and a easy template to
build other and more advanced optimization processes upon.</p>

<p>Make sure to try out the full tutorial
<a href="https://anyscript.org/tutorials/Parameter_studies_and_optimization/index.html">here.</a></p>

<p>For more details and examples of the capabilities of the
<code>Scipy.optimize</code>package, follow this
<a href="https://docs.scipy.org/doc/scipy/reference/tutorial/optimize.html">link</a></p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#optimization" class="page__taxonomy-item" rel="tag">Optimization</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#python" class="page__taxonomy-item" rel="tag">python</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#tools" class="page__taxonomy-item" rel="tag">tools</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-11-13T00:00:00+01:00">November 13, 2018</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Solving+optimization+problems+using+Python%20https%3A%2F%2Fanyscript.org%2Ftools%2FSolving-Optimization-Problems-Using-Python%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fanyscript.org%2Ftools%2FSolving-Optimization-Problems-Using-Python%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=https%3A%2F%2Fanyscript.org%2Ftools%2FSolving-Optimization-Problems-Using-Python%2F" class="btn btn--google-plus" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Google Plus"><i class="fab fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fanyscript.org%2Ftools%2FSolving-Optimization-Problems-Using-Python%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/tools/estimating-maximum-model-strength/" class="pagination--pager" title="Calculating maximum model strength
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/posts/max-strength_teaser.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/tools/estimating-maximum-model-strength/" rel="permalink">Calculating maximum model strength
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Knowing the maximum strength of a model is valuable information. In this post we show how this can be calculated easily.
</p>
  </article>
</div>
        
        
        
        
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/posts/doi_teaser.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/news/DOI/" rel="permalink">AMMR now has a DOI
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">We have added a DOI for the AMMR repository. This will help user users  communicate which version of the AMMR they are using, and make it easy to  cite the A...</p>
  </article>
</div>
        
        
        
        
      </div>
    </div>
  
  
</div>
    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
    
    
      <li><a href="https://github.com/anybody"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    
      <li><a href="https://www.linkedin.com/company/anybody-technology-a-s"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> Linkedin</a></li>
    
    
    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 AnyBody Technology A/S. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.13/js/all.js"></script>







  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-201751-2']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>






<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    showProcessingMessages: false,
    messageStyle: 'none',
    tex2jax: {
      inlineMath: [['$','$']],
      displayMath: [['$$','$$']],
      processEnvironments: false
    },
    // show equation numbers
    TeX: {
      equationNumbers: {
        autoNumber: "AMS"
      }
    },
    'HTML-CSS': {
      imageFont: null
    }
  });
</script>


  </body>
</html>